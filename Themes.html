<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>X Edge ‚Äî Goal Tools</title>
  <link rel="icon" href="xedge-logo.png">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-950 text-white">

<!-- NAV -->
<nav class="bg-gray-900/80 border-b border-gray-800 fixed w-full z-50">
  <div class="max-w-6xl mx-auto px-6 py-3 flex justify-between items-center">
    <a href="index.html" class="flex items-center gap-3">
      <img src="xedge-logo.png" class="w-8 h-8 bg-white p-1 rounded">
      <span class="font-bold">X Edge</span>
    </a>
    <button onclick="history.back()" class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg">
      ‚Üê Back
    </button>
  </div>
</nav>

<main class="pt-28 max-w-6xl mx-auto px-6">

  <!-- HEADER -->
  <div class="mb-10">
    <h1 id="goal-title" class="text-4xl font-bold mb-3"></h1>
    <p id="goal-desc" class="text-gray-400 max-w-2xl"></p>
  </div>

  <!-- TOOLS GRID -->
  <section id="goal-tools" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></section>

</main>

<script src="tools.js"></script>

<script>
console.log("üö® THEMES.HTML SCRIPT STARTED");

// Goal explanations
const GOAL_EXPLANATIONS = {
  "create your website": "Build and launch your perfect website with these AI-powered tools for design, content, and development.",
  "be an influencer": "Grow your personal brand and audience with content creation, scheduling, and analytics tools.",
  "grow a business": "Scale your business with marketing automation, customer management, and productivity tools.",
  "automate work": "Streamline repetitive tasks and boost productivity with workflow automation tools.",
  "create content": "Generate engaging content, videos, graphics, and copy with creative AI tools.",
  "learn faster": "Accelerate your learning with AI tutors, study aids, and educational platforms.",
  "build with ai": "Develop AI applications and integrate machine learning into your projects."
};

async function renderGoalPage() {
  console.log("üö® renderGoalPage started");
  
  const params = new URLSearchParams(location.search);
  const goalRaw = params.get("goal") || params.get("theme"); // ‚úÖ FIXED VARIABLE NAME
  
  if (!goalRaw) {
    console.error("üö® No goal/theme parameter found");
    document.getElementById("goal-title").textContent = "No Goal Selected";
    document.getElementById("goal-desc").textContent = "Please select a goal from the main page.";
    return;
  }

  const goal = goalRaw.toLowerCase().trim();
  console.log("üö® Processing goal:", goal);

  // Set header
  document.getElementById("goal-title").textContent = goalRaw;
  document.getElementById("goal-desc").textContent = 
    GOAL_EXPLANATIONS[goal] || `Tools to help you ${goalRaw.toLowerCase()}.`;

  try {
    // Get tools and filter by goal
    console.log("üö® Fetching tools...");
    const tools = await window.__debugFetchTools(true);
    console.log("üö® Total tools fetched:", tools.length);

    // Filter tools that have this goal (handling the space issue)
    const goalTools = tools.filter(t => {
      const toolGoal = (t.goal || t['goal '] || "").toLowerCase().trim();
      return toolGoal === goal;
    });

    console.log("üö® Tools found for this goal:", goalTools.length);

    const container = document.getElementById("goal-tools");

    if (goalTools.length === 0) {
      container.innerHTML = `
        <div class="col-span-full text-center py-12">
          <i data-feather="info" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-300 mb-2">No tools found for "${goalRaw}"</h3>
          <p class="text-gray-500">Check back soon - we're adding new tools daily!</p>
        </div>
      `;
      return;
    }

    // Render tool cards
    container.innerHTML = goalTools.map(tool => createToolCard(tool)).join('');
    console.log("üö® Tools rendered successfully");

  } catch (error) {
    console.error("üö® renderGoalPage error:", error);
    document.getElementById("goal-tools").innerHTML = 
      `<div class="text-red-500">Error loading tools: ${error.message}</div>`;
  }
}

function createToolCard(tool) {
  const logo = tool.Logo_url || 
    `https://dummyimage.com/200x200/1e293b/ffffff&text=${encodeURIComponent(tool.name)}`;

  return `
    <a href="tool.html?tool=${encodeURIComponent(tool.name)}" 
       class="bg-gray-800/40 border border-gray-700 rounded-xl p-6 
              hover:bg-gray-800/60 hover:border-gray-600 transition-all duration-200
              hover:scale-105 hover:shadow-xl">
      <div class="flex items-start gap-4">
        <img src="${logo}" 
             class="w-12 h-12 rounded-lg object-cover flex-shrink-0" 
             alt="${tool.name} logo">
        <div class="flex-1">
          <h3 class="font-bold text-lg mb-1">${tool.name}</h3>
          <p class="text-gray-400 text-sm line-clamp-3">${tool.short_description || ''}</p>
          <div class="mt-3 flex items-center justify-between">
            <span class="text-xs bg-gray-700 px-2 py-1 rounded">${tool.category || 'Other'}</span>
            <span class="text-blue-400 text-sm">View ‚Üí</span>
          </div>
        </div>
      </div>
    </a>
  `;
}

// Initialize when DOM is ready
document.addEventListener("DOMContentLoaded", function() {
  console.log("üö® DOMContentLoaded - calling renderGoalPage");
  renderGoalPage();
});
</script>

</body>
</html>
