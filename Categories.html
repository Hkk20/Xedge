<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>X Edge â€“ Categories</title>

  <!-- Firebase Core -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

   <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .loader {
      width: 50px; height: 50px;
      border: 5px solid #1e40af;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>

<body class="bg-gray-950 text-white">

<!-- ================= NAVBAR ================= -->
<nav class="bg-gray-900/80 border-b border-gray-800 fixed top-0 left-0 right-0 z-50">
  <div class="max-w-6xl mx-auto px-6 py-3 flex justify-between items-center">

    <a href="index.html" class="flex items-center gap-3">
      <img src="xedge-logo.png" class="w-8 h-8 bg-white p-1 rounded" />
      <span class="font-bold">X Edge</span>
    </a>

    <div class="flex items-center gap-6">
      <a href="index.html" class="text-gray-300 hover:text-white">Home</a>
      <a href="Explore.html" class="text-gray-300 hover:text-white">Explore</a>
      <a href="Categories.html" class="text-blue-400 font-semibold">Categories</a>
      <a href="About.html" class="text-gray-300 hover:text-white">About</a>

      <a href="Join.html"
         class="hidden md:inline-block bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-2 rounded-full text-sm">
         Join Beta
      </a>

      <!-- PROFILE / SIGN-IN AREA -->
      <div id="auth-area" class="ml-4"></div>
    </div>
  </div>
</nav>

<!-- Prevent navbar overlap -->
<div class="pt-24"></div>

<!-- Loader -->
<div id="pageLoader" class="fixed inset-0 bg-gray-900/90 flex items-center justify-center z-50 hidden">
  <div class="loader"></div>
</div>

<!-- Categories Grid -->
<div id="categories-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 p-6"></div>


<!-- ================= FETCH + RENDER CATEGORIES ================= -->
<script>
document.addEventListener("DOMContentLoaded", async () => {

  const RAW_URL = "https://script.google.com/macros/s/AKfycbxtvPEeiqcLgXv7WmTPScxBuLIo-YYVNtmWnPMW_fAi5U2-Ww7wHUfups7wcGlW7uQt/exec";
  const container = document.getElementById("categories-grid");

  async function getCachedTools() {
    const cached = localStorage.getItem("tools_cache");
    if (cached) return JSON.parse(cached);

    const res = await fetch(RAW_URL + "?nocache=" + Date.now());
    const data = await res.json();

    localStorage.setItem("tools_cache", JSON.stringify(data));
    return data;
  }

  try {
    const tools = await getCachedTools();
    const categories = [...new Set(tools.map(t => t.category?.trim()).filter(Boolean))];

    container.innerHTML = categories.map(cat => `
      <a href="category.html?cat=${encodeURIComponent(cat)}"
         class="bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center 
                hover:bg-gray-700 transition will-change-transform">
        <h3 class="font-semibold text-white">${cat}</h3>
      </a>
    `).join("");

  } catch (err) {
    console.error("Error loading categories:", err);
    container.innerHTML = `<p class="text-red-400">Cannot load categories.</p>`;
  }

});
</script>

<script>
document.addEventListener("click", (e) => {
  const link = e.target.closest("a");
  if (link && link.href.includes("category.html")) {
    document.getElementById("pageLoader").classList.remove("hidden");
  }
});
</script>


<!-- ================= AUTH SYSTEM (WORKS ON ALL PAGES) ================= -->
<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBo9cfhTj2W7ikpdrqz6wAtSBisBo78OAc",
  authDomain: "xedge-1da3a.firebaseapp.com",
  projectId: "xedge-1da3a",
  storageBucket: "xedge-1da3a.appspot.com",
  messagingSenderId: "209657807080",
  appId: "1:209657807080:web:80180596d966b4667d895d",
  measurementId: "G-SXW16HCZB8"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const provider = new firebase.auth.GoogleAuthProvider();

// LOGIN
function signInWithGoogle() {
  auth.signInWithPopup(provider).catch(() => alert("Login failed"));
}

// LOGOUT
function logoutUser() {
  auth.signOut();
}

// UI Update
auth.onAuthStateChanged((user) => {
  const area = document.getElementById("auth-area");

  if (!user) {
    area.innerHTML = `
      <button onclick="signInWithGoogle()"
        class="border border-blue-500 px-6 py-2 rounded-full 
               font-semibold text-sm text-blue-300 hover:bg-blue-500/10 transition">
        Sign In
      </button>
    `;
    return;
  }

  area.innerHTML = `
    <div class="relative group">
      <img src="${user.photoURL}"
           class="w-10 h-10 rounded-full border border-gray-700 cursor-pointer" />

      <div class="absolute right-0 mt-2 bg-gray-800 border border-gray-700 rounded-xl 
                  p-3 w-40 opacity-0 pointer-events-none group-hover:opacity-100 
                  group-hover:pointer-events-auto transition-all duration-200">

        <p class="text-white font-semibold">${user.displayName}</p>
        <p class="text-gray-400 text-xs mb-3">${user.email}</p>

        <button onclick="logoutUser()"
          class="w-full bg-red-600/20 hover:bg-red-600/30 text-red-400 p-2 rounded-lg">
          Logout
        </button>
      </div>
    </div>
  `;
});
</script>

</body>
</html>
