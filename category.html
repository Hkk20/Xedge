<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>X Edge – Category</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <style>
    .scrollbar-none::-webkit-scrollbar { display: none; }
    .scrollbar-none { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>

<body class="bg-gray-900 text-white">

<!-- ================= NAVBAR ================= -->
<nav class="bg-gray-900/80 backdrop-blur-sm fixed w-full z-30 border-b border-gray-800">
  <div class="max-w-6xl mx-auto px-6 py-3 flex justify-between items-center">

    <a href="index.html" class="flex items-center gap-3">
      <img src="xedge-logo.png" class="w-8 h-8" />
      <span class="font-bold text-lg">X Edge</span>
    </a>

    <div class="hidden md:flex items-center gap-6">
      <a href="Explore.html" class="hover:text-blue-400">Explore</a>
      <a href="Categories.html" class="hover:text-blue-400">Categories</a>

      <a href="Join.html"
         class="bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-2 rounded-full text-sm">
        Join Beta
      </a>

      <div id="auth-area"></div>
    </div>

    <!-- Mobile Back -->
    <a href="Categories.html" class="md:hidden text-gray-300 hover:text-blue-400">
      ← Back
    </a>
  </div>
</nav>

<div class="pt-24"></div>

<!-- MAIN CONTENT -->
<main class="max-w-6xl mx-auto px-6 pb-24">
  <h1 id="categoryTitle" class="text-3xl font-bold mb-6">Loading...</h1>
  <section id="toolsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></section>
</main>


<script>
// Prevent infinite loading on back navigation
window.addEventListener("pageshow", (event) => {
  if (event.persisted) window.location.reload();
});

document.addEventListener("DOMContentLoaded", async () => {

  const RAW_URL = "https://script.google.com/macros/s/AKfycbxaA3BcQgW7PTFlSP9j4h16-p2us5IiuaYESUUpZiy8bObezI-nMUxXAC28tR15FU_U/exec";

  const params = new URLSearchParams(window.location.search);
  const selectedCat = params.get("cat")?.trim();

  const titleEl = document.getElementById("categoryTitle");
  const container = document.getElementById("toolsContainer");

  if (!selectedCat) {
    titleEl.textContent = "Unknown Category";
    container.innerHTML = `<p class="text-gray-400">No category selected.</p>`;
    return;
  }

  titleEl.textContent = selectedCat;

  async function fetchTools() {
    let res = await fetch(RAW_URL + "?v=" + Date.now());
    return res.json();
  }

  const tools = await fetchTools();

  const normalized = tools.map(t => ({
    name: t.name || "Unknown",
    description: t.description || t.short_description || "",
    category: t.category || "",
    logo_url: t.logo_url || "",
  }));

  const key = selectedCat.toLowerCase().replace(/\s+/g, "");

  const filtered = normalized.filter(t =>
    (t.category || "").toLowerCase().replace(/\s+/g, "") === key
  );

  if (!filtered.length) {
    container.innerHTML = `<p class="text-gray-400">No tools found.</p>`;
    return;
  }

  // FIX: Link to tool.html instead of external website
  container.innerHTML = filtered.map(tool => {
    const img = tool.logo_url || "https://via.placeholder.com/200x200?text=X+Edge";

    return `
      <a href="tool.html?tool=${encodeURIComponent(tool.name)}"
         class="block bg-gray-800 border border-gray-700 p-6 rounded-xl hover:bg-gray-700 transition">

        <img src="${img}"
             class="w-16 h-16 mx-auto mb-4 object-cover rounded"
             onerror="this.src='https://via.placeholder.com/200?text=No+Image'">

        <h3 class="text-lg font-semibold text-center">${tool.name}</h3>

        <p class="text-gray-300 text-sm text-center mt-2">
          ${tool.description.slice(0, 160)}
        </p>

        <p class="text-blue-400 text-center mt-3">View Details →</p>
      </a>
    `;
  }).join("");

});
</script>

<!-- FIXED: Correct script tag -->
<script src="auth.js"></script>

</body>
</html>
